




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forecasting 2.0 Demo</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@radix-ui/colors@latest/styles.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Roboto+Mono:wght@400;500&display=swap');
        
        /* Tokens moved to tokens.css */
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f2f4f7; /* more enterprise, higher contrast */
            color: #111111;
            min-height: 100vh;
        }
        
        /* Professional hover effects */
        .card-hover {
            transition: all 0.2s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .kpi-card {
            background: #f8fafc; /* visibly muted surface */
            border: 2px solid var(--border);
            border-left: 4px solid var(--brand-600); /* prominent brand accent */
            transition: all 0.2s ease;
        }
        
        .kpi-card:hover {
            border-color: #1E4DD8;
            box-shadow: 0 0 0 1px rgba(30, 77, 216, 0.1);
        }
        
        .role-btn {
            transition: all 0.15s ease;
        }
        
        .role-btn:hover {
            background-color: #f3f4f6;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-high { background-color: #6b7280; }
        .status-medium { background-color: #9ca3af; }
        .status-low { background-color: #374151; }
        
        .text-positive { color: #111111; }
        .text-negative { color: #374151; }
        .text-warning { color: #6b7280; }
        
        .bg-positive { background-color: #f9fafb; }
        .bg-negative { background-color: #f3f4f6; }
        .bg-warning { background-color: #f9fafb; }
        
        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }
    </style>
    <style>
        /* Enterprise tokens are defined in tokens.css */

        /* Focus policy */
        :focus-visible {
            outline: 2px solid var(--brand-600);
            outline-offset: 2px;
            border-radius: var(--radius-sm);
        }
    </style>

    <style type="text/tailwindcss">
        @layer components {
            .btn { @apply inline-flex items-center justify-center gap-2 px-3.5 py-2.5 text-sm font-medium rounded-md transition-colors; }
            .btn-primary { background: var(--brand-600); color: #fff; }
            .btn-primary:hover { background: var(--brand-700); }
            .btn-secondary { @apply bg-white border text-gray-700; border-color: var(--border); }
            .btn-secondary:hover { background: #f8fafc; }

            .card { @apply bg-white border; border-color: var(--border); box-shadow: var(--shadow-card); border-radius: var(--radius-lg); border-width: 2px; }
            .input { @apply w-full px-3 py-2 text-sm border rounded-md; border-color: var(--border); }
            .badge { @apply inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md; }
            .badge-muted { @apply bg-gray-100 text-gray-700; }

            /* Reuse for existing tiles */
            .kpi-card { border-radius: var(--radius-lg); }
        }
    </style>
    <link rel="stylesheet" href="./tokens.css?v=enterprise" />
</head>
<body>
    <div id="app" class="flex h-screen bg-gray-50">
        <!-- Left Navigation Panel -->
        <div class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <!-- Brand/Logo -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3 cursor-pointer hover:bg-gray-50 rounded-lg p-2 -m-2" onclick="goToHomepage()">
                    <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg flex items-center justify-center">
                        <i data-lucide="zap" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">Invisible</h1>
                        <p class="text-sm text-gray-500">NEURON</p>
                    </div>
                </div>
            </div>

            <!-- Group Identifier -->
            <div class="px-6 py-3 border-b border-gray-200">
                <p class="text-sm font-medium text-gray-700">G Group Alpha</p>
            </div>

            <!-- Navigation Menu -->
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md">
                    <i data-lucide="clock" class="w-4 h-4"></i>
                    <span>Pipeline Status</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    <span>Data Quality</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md">
                    <i data-lucide="network" class="w-4 h-4"></i>
                    <span>Data Ontology</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md">
                    <i data-lucide="trending-up" class="w-4 h-4"></i>
                    <span>Forecasting</span>
                </a>
            </nav>

            <!-- Bottom Section -->
            <div class="p-4 border-t border-gray-200">
                <a href="#" class="flex items-center space-x-2 text-sm text-gray-500 hover:text-gray-700 mb-4">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    <span>Collapse Navigation</span>
                </a>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-gray-600"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-900">Tony</p>
                        <p class="text-xs text-gray-500">tony@alpha.com</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-slate-900 text-white border-b border-slate-800 px-6 py-4">
                <div class="flex flex-col lg:justify-between space-y-4">
                    <!-- Page Title and Breadcrumbs -->
                    <div class="flex flex-col space-y-2">
                        <div>
                            <h1 class="text-2xl font-semibold text-white">Forecasting</h1>
                            <p class="text-sm text-slate-300">Predict future demand with confidence to empower accurate and agile demand planning</p>
                        </div>
                        <!-- Breadcrumbs (moved under tagline) -->
                        <nav class="flex items-center space-x-2 text-sm text-slate-300" id="breadcrumbs">
                            <span class="cursor-pointer hover:text-blue-600" onclick="goToPortfolio()">Portfolio</span>
                            <span>/</span>
                            <span class="text-white">Overview</span>
                        </nav>
                    </div>

                    <!-- Controls removed -->
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 overflow-auto p-6">
            <!-- Hero Section -->
            <div class="mb-8">
                <h1 class="text-3xl font-semibold text-gray-900 mb-2">Portfolio Overview</h1>
                <p class="text-gray-500" id="role-description">
                    Revenue risk and inventory insights for operational decisions
                </p>
            </div>

            <!-- Hero KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="kpi-card card-hover card p-6 cursor-pointer" onclick="drillDown('portfolio')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">Total Revenue</p>
                            <p class="text-2xl font-semibold text-gray-900">$2.4M</p>
                            <p class="text-sm text-gray-500 mt-1">Last 24 months</p>
                        </div>
                        <div class="text-blue-600">
                            <i data-lucide="dollar-sign" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1 mt-3">
                        <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                        <span class="text-sm font-medium text-green-600">+12.3%</span>
                    </div>
                </div>

                <div class="kpi-card card-hover card p-6 cursor-pointer" onclick="drillDown('forecast')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">Forecast Revenue</p>
                            <p class="text-2xl font-semibold text-gray-900">$2.7M</p>
                            <p class="text-sm text-gray-500 mt-1">Next 3 months</p>
                        </div>
                        <div class="text-blue-600">
                            <i data-lucide="trending-up" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1 mt-3">
                        <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                        <span class="text-sm font-medium text-green-600">+12.3%</span>
                    </div>
                </div>

                <div class="kpi-card card-hover card p-6 cursor-pointer" onclick="drillDown('misses')">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">Miss Rate</p>
                            <p class="text-2xl font-semibold text-gray-900">8.2%</p>
                            <p class="text-sm text-gray-500 mt-1">Model vs Baseline</p>
                        </div>
                        <div class="text-blue-600">
                            <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1 mt-3">
                        <i data-lucide="trending-down" class="w-4 h-4 text-red-600"></i>
                        <span class="text-sm font-medium text-red-600">-5.2%</span>
                    </div>
                </div>
            </div>

            <!-- Role-specific KPIs -->
            <div id="role-specific-kpis" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Ops KPIs -->
                <div class="card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">Inventory Risk</p>
                            <p class="text-2xl font-semibold text-gray-900">Medium</p>
                            <p class="text-sm text-gray-500 mt-1">3 categories at risk</p>
                        </div>
                        <div class="text-blue-600">
                            <i data-lucide="package" class="w-6 h-6"></i>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">Stockout Risk</p>
                            <p class="text-2xl font-semibold text-gray-900">Low</p>
                            <p class="text-sm text-gray-500 mt-1">2 SKUs flagged</p>
                        </div>
                        <div class="text-blue-600">
                            <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Chart -->
            <div class="card p-6 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Revenue Forecast vs Actuals</h3>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                            <span class="text-sm text-gray-500">Model Forecast</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                            <span class="text-sm text-gray-500">Baseline</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-600 rounded-full"></div>
                            <span class="text-sm text-gray-500">Actual</span>
                        </div>
                    </div>
                </div>
                <div class="h-80 bg-white rounded-lg">
                    <div id="portfolio-chart" class="w-full h-full"></div>
                </div>
            </div>

            <!-- Callouts Panel -->
            <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Insights</h3>
                <div class="space-y-3">
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-green-600 rounded-full mt-2"></div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Electronics category up 22%</p>
                            <p class="text-xs text-gray-500">Supply down. Reorder now.</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Clothing confidence low</p>
                            <p class="text-xs text-gray-500">Sparse history. Investigate.</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-red-600 rounded-full mt-2"></div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Toys & Games forecast down 15%</p>
                            <p class="text-xs text-gray-500">Weeks of supply >8. Markdown recommended.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CTA Tiles -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <button class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow text-left">
                    <div class="flex items-center space-x-3 mb-2">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-600"></i>
                        <h4 class="font-semibold text-gray-900">View Categories</h4>
                    </div>
                    <p class="text-sm text-gray-500">Drill down into category performance</p>
                </button>
                
                <button class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow text-left">
                    <div class="flex items-center space-x-3 mb-2">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-500"></i>
                        <h4 class="font-semibold text-gray-900">View Misses</h4>
                    </div>
                    <p class="text-sm text-gray-500">Analyze forecast errors</p>
                </button>
                
                <button class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow text-left">
                    <div class="flex items-center space-x-3 mb-2">
                        <i data-lucide="package" class="w-5 h-5 text-green-600"></i>
                        <h4 class="font-semibold text-gray-900">View Actions</h4>
                    </div>
                    <p class="text-sm text-gray-500">Take recommended actions</p>
                </button>
            </div>
            </main>
        </div>
    </div>

    <!-- V1 View (Hidden by default) -->
    <div id="v1-view" class="hidden flex h-screen bg-gray-50">
        <!-- Left Navigation Panel (Same as V2) -->
        <div class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <!-- Brand/Logo -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3 cursor-pointer hover:bg-gray-50 rounded-lg p-2 -m-2" onclick="goToHomepage()">
                    <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg flex items-center justify-center">
                        <i data-lucide="zap" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">Invisible</h1>
                        <p class="text-sm text-gray-500">NEURON</p>
                    </div>
                </div>
            </div>

            <!-- Group Identifier -->
            <div class="px-6 py-3 border-b border-gray-200">
                <p class="text-sm font-medium text-gray-700">G Group Alpha</p>
            </div>

            <!-- Navigation Menu -->
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md">
                    <i data-lucide="clock" class="w-4 h-4"></i>
                    <span>Pipeline Status</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    <span>Data Quality</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md">
                    <i data-lucide="network" class="w-4 h-4"></i>
                    <span>Data Ontology</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md">
                    <i data-lucide="trending-up" class="w-4 h-4"></i>
                    <span>Forecasting</span>
                </a>
            </nav>

            <!-- Bottom Section -->
            <div class="p-4 border-t border-gray-200">
                <a href="#" class="flex items-center space-x-2 text-sm text-gray-500 hover:text-gray-700 mb-4">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    <span>Collapse Navigation</span>
                </a>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-gray-600"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-900">Tony</p>
                        <p class="text-xs text-gray-500">tony@alpha.com</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-semibold text-gray-900">Forecasting 1.0</h1>
                        <p class="text-sm text-gray-500">Legacy forecasting interface</p>
                    </div>
                </div>
            </header>
            
            <!-- V1 Content -->
            <main class="flex-1 overflow-auto p-6">
                <div class="bg-white rounded-lg border border-gray-200 p-8 shadow-sm">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gray-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                            <i data-lucide="bar-chart-3" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-2">V1 View Placeholder</h2>
                        <p class="text-gray-500 mb-6">
                            This is where the V1 screenshot will be displayed. 
                            The old clunky table view will be shown here for contrast.
                        </p>
                        <div class="bg-gray-50 rounded-lg p-6 text-left">
                            <div class="text-sm text-gray-500 mb-2">Legacy Forecasting 1.0 Interface</div>
                            <div class="font-mono text-xs text-gray-400">
                                [Static table with basic metrics would be displayed here]
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Runtime enterprise theming via URL param (?theme=enterprise)
        (function applyRuntimeTheme() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('theme') === 'enterprise') {
                document.documentElement.style.setProperty('--border', '#98A2B3');
                document.documentElement.style.setProperty('--surface', '#FFFFFF');
                document.documentElement.style.setProperty('--surface-muted', '#F4F6F8');
                document.documentElement.style.setProperty('--brand-600', '#1F3AAE');
                document.body.style.background = '#EDF1F5';
                document.querySelectorAll('.kpi-card').forEach(el => {
                    el.style.borderWidth = '2px';
                    el.style.borderLeft = '6px solid var(--brand-600)';
                    el.style.background = 'var(--surface)';
                });
            }
        })();

        // App state
        let currentRole = 'ops';
        let isV1View = false;
        let currentView = 'portfolio'; // portfolio, category, sku
        let selectedCategory = null;
        let selectedSKU = null;
        let selectedSKUName = null;
        let categoryChartScope = 'category'; // 'category' | 'portfolio'

        // Deep-linking helpers
        function readParams() {
            const p = new URLSearchParams(window.location.search);
            const view = p.get('view') || 'portfolio';
            const cat = p.get('cat');
            const sku = p.get('sku');
            return { view, cat, sku };
        }

        function updateURL(view, cat, sku, replace=false) {
            const p = new URLSearchParams(window.location.search);
            p.set('view', view);
            if (cat) { p.set('cat', cat); } else { p.delete('cat'); }
            if (sku) { p.set('sku', sku); } else { p.delete('sku'); }
            const url = `${location.pathname}?${p.toString()}`;
            const state = { view, cat, sku };
            if (replace) history.replaceState(state, '', url); else history.pushState(state, '', url);
        }

        // Role descriptions
        const roleDescriptions = {
            ops: 'Revenue risk and inventory insights for operational decisions',
            engineer: 'Model performance and data quality metrics',
            marketer: 'Demand patterns and promotional effectiveness'
        };

        // Role-specific KPIs
        const roleKPIs = {
            ops: [
                { title: 'Inventory Risk', value: 'Medium', subtitle: '3 categories at risk', icon: 'package' },
                { title: 'Stockout Risk', value: 'Low', subtitle: '2 SKUs flagged', icon: 'alert-triangle' }
            ],
            engineer: [
                { title: 'Model Accuracy', value: '87.3%', subtitle: 'MAPE improvement', icon: 'bar-chart-3', change: '+2.1%' },
                { title: 'Data Quality', value: 'High', subtitle: '98.2% completeness', icon: 'eye' }
            ],
            marketer: [
                { title: 'Demand Spikes', value: '12', subtitle: 'SKUs with >20% increase', icon: 'trending-up' },
                { title: 'Promo Effectiveness', value: '+34%', subtitle: 'Average lift', icon: 'dollar-sign', change: '+8.2%' }
            ]
        };

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Guarded role switcher (buttons may be removed)
            const roleButtons = document.querySelectorAll('.role-btn');
            if (roleButtons && roleButtons.length) {
                roleButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active', 'bg-white', 'text-gray-900', 'shadow-sm'));
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.add('text-gray-500'));
                    this.classList.add('active', 'bg-white', 'text-gray-900', 'shadow-sm');
                    this.classList.remove('text-gray-500');
                    currentRole = this.dataset.role;
                    updateRoleContent();
                });
            });
            }

            // Guarded V1/V2 toggle (element may be removed)
            const toggleEl = document.getElementById('v1-toggle');
            if (toggleEl) {
                toggleEl.addEventListener('click', function() {
                isV1View = !isV1View;
                toggleV1View();
            });
            }
            // Initial route from URL
            const { view, cat, sku } = readParams();
            currentView = view;
            selectedCategory = cat;
            selectedSKU = sku;
            if (view === 'category') {
                showCategoryView();
            } else if (view === 'sku') {
                showSKUView();
            } else if (view === 'sku-detail') {
                showSKUDetail();
            } else {
                showPortfolioView();
            }

            // Mount portfolio chart if container exists
            setTimeout(renderPortfolioChart, 50);

            // Back/forward handling
            window.onpopstate = () => {
                const { view: v2, cat: c2, sku: s2 } = readParams();
                currentView = v2;
                selectedCategory = c2;
                selectedSKU = s2;
                if (v2 === 'category') showCategoryView();
                else if (v2 === 'sku') showSKUView();
                else if (v2 === 'sku-detail') showSKUDetail();
                else showPortfolioView();
                setTimeout(renderPortfolioChart, 50);
            };
        });

        // Fake data + Recharts render
        const chartData = [
            { month: '2024-07', actual: 4.6, baseline: 4.5, model: 4.6 },
            { month: '2024-08', actual: 4.9, baseline: 4.7, model: 4.8 },
            { month: '2024-09', actual: 4.7, baseline: 4.8, model: 4.7 },
            { month: '2024-10', actual: 0.0, baseline: 5.2, model: 5.3 },
            { month: '2024-11', actual: 0.0, baseline: 5.4, model: 5.6 },
            { month: '2024-12', actual: 0.0, baseline: 5.6, model: 5.9 }
        ];

        // Per-category fake series (same shape as portfolio but different values)
        const categorySeries = {
            electronics: [
                { month: '2024-07', actual: 0.8, baseline: 0.75, model: 0.78 },
                { month: '2024-08', actual: 0.86, baseline: 0.79, model: 0.83 },
                { month: '2024-09', actual: 0.84, baseline: 0.81, model: 0.82 },
                { month: '2024-10', actual: 0.0, baseline: 0.88, model: 0.92 },
                { month: '2024-11', actual: 0.0, baseline: 0.91, model: 0.95 },
                { month: '2024-12', actual: 0.0, baseline: 0.93, model: 0.98 }
            ],
            clothing: [
                { month: '2024-07', actual: 0.32, baseline: 0.36, model: 0.33 },
                { month: '2024-08', actual: 0.35, baseline: 0.37, model: 0.34 },
                { month: '2024-09', actual: 0.34, baseline: 0.36, model: 0.33 },
                { month: '2024-10', actual: 0.0, baseline: 0.35, model: 0.31 },
                { month: '2024-11', actual: 0.0, baseline: 0.34, model: 0.30 },
                { month: '2024-12', actual: 0.0, baseline: 0.33, model: 0.29 }
            ],
            toys: [
                { month: '2024-07', actual: 0.18, baseline: 0.20, model: 0.19 },
                { month: '2024-08', actual: 0.19, baseline: 0.21, model: 0.20 },
                { month: '2024-09', actual: 0.20, baseline: 0.22, model: 0.21 },
                { month: '2024-10', actual: 0.0, baseline: 0.24, model: 0.26 },
                { month: '2024-11', actual: 0.0, baseline: 0.26, model: 0.28 },
                { month: '2024-12', actual: 0.0, baseline: 0.28, model: 0.30 }
            ]
        };

        function renderPortfolioChart() {
            const mount = document.getElementById('portfolio-chart');
            if (!mount) return;
            // Clear any previous render and unmount React component
            if (window.ReactDOM && ReactDOM.unmountComponentAtNode) {
                try { ReactDOM.unmountComponentAtNode(mount); } catch (_) {}
            }
            mount.innerHTML = '';
            const { ResponsiveContainer, LineChart, CartesianGrid, XAxis, YAxis, Tooltip, Legend, Line } = Recharts;

            function currency(v){ return `$${v.toFixed(2)}M`; }

            const Chart = () => (
                React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                    React.createElement(LineChart, { data: chartData, margin: { top: 8, right: 24, left: 0, bottom: 8 } },
                        React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#E5E7EB' }),
                        React.createElement(XAxis, { dataKey: 'month', tick: { fill: '#64748B' }, axisLine: { stroke: '#CBD5E1' } }),
                        React.createElement(YAxis, { tick: { fill: '#64748B' }, axisLine: { stroke: '#CBD5E1' }, tickFormatter: currency }),
                        React.createElement(Tooltip, { formatter: (v, n) => [currency(v), n === 'actual' ? 'Actuals' : n === 'baseline' ? 'Baseline' : 'Model Forecast'] }),
                        React.createElement(Legend, { verticalAlign: 'bottom', height: 24 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'actual', name: 'Actuals', stroke: '#2563EB', dot: false, strokeWidth: 2 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'baseline', name: 'Baseline', stroke: '#64748B', dot: false, strokeWidth: 2 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'model', name: 'Model Forecast', stroke: '#EF4444', dot: false, strokeWidth: 2 })
                    )
                )
            );

            ReactDOM.render(React.createElement(Chart), mount);
        }

        function renderCategoryChart() {
            const mount = document.getElementById('category-chart');
            if (!mount) return;
            // Fully unmount any previous chart to avoid stale internal state
            if (window.ReactDOM && ReactDOM.unmountComponentAtNode) {
                try { ReactDOM.unmountComponentAtNode(mount); } catch (_) {}
            }
            mount.innerHTML = '';
            const subtitleEl = document.getElementById('category-chart-subtitle');
            const activeCat = selectedCategory || 'electronics';
            const data = categoryChartScope === 'portfolio' ? (Array.isArray(chartData) ? chartData.slice() : []) : (categorySeries[activeCat] || categorySeries.electronics);
            if (subtitleEl) {
                const label = categoryChartScope === 'portfolio' ? 'Portfolio (all categories)' : `Category: ${activeCat}`;
                subtitleEl.textContent = label;
            }
            const { ResponsiveContainer, LineChart, CartesianGrid, XAxis, YAxis, Tooltip, Legend, Line } = Recharts;
            function currency(v){ return `$${v.toFixed(2)}M`; }
            const Chart = () => (
                React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                    React.createElement(LineChart, { data, margin: { top: 8, right: 24, left: 8, bottom: 24 } },
                        React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#E5E7EB' }),
                        React.createElement(XAxis, { dataKey: 'month', tick: { fill: '#64748B' }, tickMargin: 8, interval: 'preserveEnd', axisLine: { stroke: '#CBD5E1' } }),
                        React.createElement(YAxis, { tick: { fill: '#64748B' }, width: 60, axisLine: { stroke: '#CBD5E1' }, domain: [0, 'auto'], tickFormatter: currency }),
                        React.createElement(Tooltip, { formatter: (v, n) => [currency(v), n === 'actual' ? 'Actuals' : n === 'baseline' ? 'Baseline' : 'Model Forecast'] }),
                        React.createElement(Legend, { verticalAlign: 'bottom', height: 24 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'actual', name: 'Actuals', stroke: '#2563EB', dot: false, strokeWidth: 2 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'baseline', name: 'Baseline', stroke: '#64748B', dot: false, strokeWidth: 2 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'model', name: 'Model Forecast', stroke: '#EF4444', dot: false, strokeWidth: 2 })
                    )
                )
            );
            ReactDOM.render(React.createElement(Chart), mount);
        }

        function updateCategoryScopeButtons() {
            const btnCat = document.getElementById('btn-scope-category');
            const btnPort = document.getElementById('btn-scope-portfolio');
            if (!btnCat || !btnPort) return;
            if (categoryChartScope === 'category') {
                btnCat.classList.add('bg-white','shadow-sm','border');
                btnCat.classList.remove('text-gray-600');
                btnPort.classList.remove('bg-white','shadow-sm','border');
                btnPort.classList.add('text-gray-600');
            } else {
                btnPort.classList.add('bg-white','shadow-sm','border');
                btnPort.classList.remove('text-gray-600');
                btnCat.classList.remove('bg-white','shadow-sm','border');
                btnCat.classList.add('text-gray-600');
            }
        }

        // Helper when clicking a category tile to keep scope UI intact
        function chooseCategory(cat) {
            selectedCategory = cat;
            currentView = 'category';
            updateBreadcrumbs();
            showCategoryView();
            updateURL('category', selectedCategory, null);
        }

        // ---------- SKU detail charts & action ----------
        function buildSKUBaseSeries() {
            // Start from portfolio pattern but add SKU-specific noise
            return chartData.map((p, i) => ({
                month: p.month,
                actual: Math.max(0, p.actual + (i%3-1)*0.05),
                baseline: p.baseline + ((i%4-2)*0.03),
                model: p.model + ((i%5-2)*0.04)
            }));
        }

        function renderSKUHistoricalChart() {
            const mount = document.getElementById('sku-historical-chart');
            if (!mount) return;
            if (window.ReactDOM && ReactDOM.unmountComponentAtNode) { try { ReactDOM.unmountComponentAtNode(mount); } catch(_){} }
            mount.innerHTML = '';
            const data = buildSKUBaseSeries();
            const { ResponsiveContainer, LineChart, CartesianGrid, XAxis, YAxis, Tooltip, Legend, Line } = Recharts;
            function currency(v){ return `$${v.toFixed(2)}M`; }
            const Chart = () => (
                React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                    React.createElement(LineChart, { data, margin: { top: 8, right: 24, left: 8, bottom: 8 } },
                        React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#E5E7EB' }),
                        React.createElement(XAxis, { dataKey: 'month', tick: { fill: '#64748B' }, axisLine: { stroke: '#CBD5E1' } }),
                        React.createElement(YAxis, { tick: { fill: '#64748B' }, width: 60, tickFormatter: currency, axisLine: { stroke: '#CBD5E1' } }),
                        React.createElement(Tooltip, { formatter: (v, n) => [currency(v), n==='actual'?'Actuals':n==='baseline'?'Baseline':'Model'] }),
                        React.createElement(Legend, { verticalAlign: 'bottom', height: 24 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'actual', name: 'Actuals', stroke: '#2563EB', dot: false, strokeWidth: 2 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'baseline', name: 'Baseline', stroke: '#64748B', dot: false, strokeWidth: 2 }),
                        React.createElement(Line, { type: 'monotone', dataKey: 'model', name: 'Model', stroke: '#EF4444', dot: false, strokeWidth: 2 })
                    )
                )
            );
            ReactDOM.render(React.createElement(Chart), mount);
        }

        function renderSKUProjectionChart() {
            const mount = document.getElementById('sku-projection-chart');
            if (!mount) return;
            if (window.ReactDOM && ReactDOM.unmountComponentAtNode) { try { ReactDOM.unmountComponentAtNode(mount); } catch(_){} }
            mount.innerHTML = '';
            const { ResponsiveContainer, AreaChart, CartesianGrid, XAxis, YAxis, Tooltip, Area, Legend } = Recharts;
            function currency(v){ return `$${v.toFixed(2)}M`; }
            // Next 3 months projection with bands
            const last = chartData[chartData.length-1]?.model || 4.7;
            const months = ['M+1','M+2','M+3'];
            const proj = months.map((m, i) => {
                const mean = last + 0.2*(i+1);
                const band = 0.25 + i*0.05;
                return { month: m, lower: Math.max(0, mean - band), mean, upper: mean + band };
            });
            const Chart = () => (
                React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                    React.createElement(AreaChart, { data: proj, margin: { top: 8, right: 24, left: 8, bottom: 8 } },
                        React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#F1F5F9' }),
                        React.createElement(XAxis, { dataKey: 'month', tick: { fill: '#64748B' } }),
                        React.createElement(YAxis, { tick: { fill: '#64748B' }, width: 60, tickFormatter: currency }),
                        React.createElement(Tooltip, { formatter: (v) => currency(v) }),
                        React.createElement(Legend, { verticalAlign: 'bottom', height: 24 }),
                        React.createElement(Area, { type: 'monotone', dataKey: 'upper', stroke: 'transparent', fill: '#93C5FD', fillOpacity: 0.2, activeDot: false }),
                        React.createElement(Area, { type: 'monotone', dataKey: 'lower', stroke: 'transparent', fill: '#FFFFFF', fillOpacity: 1 }),
                        React.createElement(Area, { type: 'monotone', dataKey: 'mean', name: 'Forecast', stroke: '#7C3AED', fill: 'none', strokeWidth: 2 })
                    )
                )
            );
            ReactDOM.render(React.createElement(Chart), mount);
        }

        function renderSKUAction() {
            const el = document.getElementById('sku-action-card');
            if (!el) return;
            const rec = getSKUActionRecommendation();
            // Rail color and subtle tint based on action type
            const rail = document.getElementById('sku-action-rail');
            const palette = rec.action === 'Markdown' ? { rail: '#DC2626', tint: 'rgba(220,38,38,0.06)' } : rec.action === 'Investigate' ? { rail: 'var(--accent-amber-600)', tint: 'rgba(217,119,6,0.08)' } : { rail: '#2563EB', tint: 'rgba(37,99,235,0.06)' };
            if (rail) rail.style.backgroundColor = palette.rail;
            // Shared visual language between action and stock cards
            el.style.backgroundColor = palette.tint;
            const actionWrap = document.getElementById('sku-action-wrap');
            if (actionWrap) actionWrap.style.borderTop = `2px solid ${palette.rail}`;
            const stockWrap = document.getElementById('sku-stock-card');
            if (stockWrap) {
                stockWrap.style.backgroundColor = palette.tint;
                stockWrap.style.borderTop = `2px solid ${palette.rail}`;
            }
            el.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <div class="text-xs uppercase tracking-wide mb-1" style="color: var(--accent-amber-700)">Recommended Action</div>
                        <div class="text-xl font-semibold text-gray-900">${rec.headline}</div>
                    </div>
                    ${rec.priorityHTML}
                </div>
                <div class="mb-3 flex flex-wrap gap-x-4 gap-y-2">
                    ${rec.metricChipsHTML}
                </div>
                <ul class="text-sm text-gray-800 list-disc pl-5 space-y-1 mb-2">
                    ${rec.reasons.map(r => `<li>${r}</li>`).join('')}
                </ul>
                <div class="flex items-center gap-3">${rec.suggestionHTML} ${rec.calcHTML}</div>
            `;
            lucide.createIcons();
            const btn = document.getElementById('execute-action-btn');
            if (btn) btn.onclick = () => openActionModal(rec);
            renderStockRiskCard();
        }

        function renderStockRiskCard() {
            const el = document.getElementById('sku-stock-card');
            if (!el) return;
            // Use the same synthetic numbers used by recommendation
            const weeklyForecast = 120;
            const stockOnHand = 380;
            const targetWOS = 6;
            const wos = stockOnHand / weeklyForecast;
            const risk = wos < 3 ? 'High' : wos < 5 ? 'Medium' : 'Low';
            const pct = Math.min(100, Math.round((stockOnHand / (targetWOS*weeklyForecast)) * 100));
            el.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Stock & Risk</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between"><span class="text-gray-500">Stock on hand</span><span class="font-medium">${stockOnHand} units</span></div>
                    <div class="flex justify-between"><span class="text-gray-500">Weeks of supply</span><span class="font-medium">${wos.toFixed(1)}</span></div>
                    <div class="flex justify-between"><span class="text-gray-500">Target WOS</span><span class="font-medium">${targetWOS}</span></div>
                    <div class="flex justify-between"><span class="text-gray-500">Risk level</span><span class="font-medium ${wos<3?'text-red-600':wos<5?'text-[var(--accent-amber-700)]':'text-green-700'}">${risk}</span></div>
                </div>
                <div class="mt-4">
                    <div class="flex justify-between text-xs text-gray-500 mb-1">
                        <span>Stock vs target</span><span>${pct}%</span>
                    </div>
                    <div class="h-2 w-full bg-gray-100 rounded">
                        <div class="h-2 bg-blue-600 rounded" style="width:${pct}%"></div>
                    </div>
                </div>
            `;
        }

        function getSKUActionRecommendation() {
            // Synthetic values for demo purposes
            const weeklyForecast = 120; // units/week
            const stockOnHand = 380; // units
            const wos = stockOnHand / weeklyForecast; // weeks of supply
            const lift = 22; // % vs baseline
            const confidence = 87; // %
            const modelMAPE = 8.2; // %
            const baselineMAPE = 15.7; // %
            const improvement = baselineMAPE - modelMAPE; // pp

            let action = 'Hold';
            const reasons = [];
            let suggestionHTML = '';
            let priorityHTML = '';
            let metricChipsHTML = '';
            let headline = '';
            let calcHTML = '';

            if (lift >= 10 && confidence >= 70 && wos < 4) {
                action = 'Reorder';
                const targetWOS = 6;
                const qty = Math.max(0, Math.ceil(targetWOS * weeklyForecast - stockOnHand));
                reasons.push(`Forecast lift +${lift}%, confidence ${confidence}%`);
                reasons.push(`Weeks of supply ${wos.toFixed(1)} < target ${targetWOS}`);
                headline = `Reorder ${qty} units`;
                suggestionHTML = `<button id="execute-action-btn" class="btn btn-primary">Execute Reorder (${qty} units)</button>`;
                calcHTML = `<button class="btn btn-secondary" onclick="alert('Target WOS ${targetWOS} * weekly ${weeklyForecast} âˆ’ stock ${stockOnHand} = ${Math.max(0, Math.ceil(targetWOS * weeklyForecast - stockOnHand))}')">View calculation</button>`;
                if (wos < 3) priorityHTML = `<span class="inline-flex items-center text-xs font-medium px-2 py-1 rounded-md bg-red-50 text-red-700 border border-red-200">High priority</span>`;
            } else if ((lift <= -10 || wos > 10) && confidence >= 60 && improvement >= 5) {
                action = 'Markdown';
                const discount = Math.min(30, Math.max(10, Math.round((wos - 8) * 3)));
                reasons.push(`Demand down/Large overstock (WOS ${wos.toFixed(1)})`);
                reasons.push(`Model beats baseline by ${improvement.toFixed(1)}pp`);
                headline = `Markdown ${discount}%`;
                suggestionHTML = `<button id="execute-action-btn" class="btn btn-primary">Execute Markdown (${discount}% off)</button>`;
                calcHTML = `<button class="btn btn-secondary" onclick="alert('WOS-based discount heuristic: max 30%, typically (WOS-8)*3%')">View calculation</button>`;
            } else if (confidence < 55 || modelMAPE >= 15) {
                action = 'Investigate';
                reasons.push(`Low predictability (confidence ${confidence}%, MAPE ${modelMAPE}%)`);
                headline = 'Open Investigation';
                suggestionHTML = `<button id="execute-action-btn" class="btn btn-secondary">Open Investigation</button>`;
            } else {
                reasons.push('Monitor next 2 weeks; metrics within thresholds');
                headline = 'Set Watch';
                suggestionHTML = `<button id="execute-action-btn" class="btn btn-secondary">Set Watch</button>`;
            }

            metricChipsHTML = `
                <span class="inline-flex items-center text-xs font-medium px-2 py-1 rounded-md bg-gray-100 text-gray-700">Lift +${lift}%</span>
                <span class="inline-flex items-center text-xs font-medium px-2 py-1 rounded-md bg-gray-100 text-gray-700">Confidence ${confidence}%</span>
                <span class="inline-flex items-center text-xs font-medium px-2 py-1 rounded-md bg-gray-100 text-gray-700">WOS ${wos.toFixed(1)}</span>`;

            return { action, reasons, suggestionHTML, priorityHTML, metricChipsHTML, headline, calcHTML };
        }

        // No spark in Option A layout

        function openActionModal(rec) {
            // Simple confirm modal
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50';
            overlay.innerHTML = `
                <div class="bg-white rounded-lg border border-gray-200 p-6 w-full max-w-md shadow-lg">
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Confirm ${rec.action}</h4>
                    <p class="text-sm text-gray-600 mb-4">This will queue the action for Ops. Proceed?</p>
                    <div class="flex justify-end space-x-2">
                        <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                        <button id="modal-confirm" class="btn btn-primary">Confirm</button>
                    </div>
                </div>`;
            document.body.appendChild(overlay);
            document.getElementById('modal-cancel').onclick = () => overlay.remove();
            document.getElementById('modal-confirm').onclick = () => {
                console.log('Action executed:', rec.action, 'for', selectedSKU);
                overlay.remove();
                alert('Action queued successfully.');
            };
        }

        function updateRoleContent() {
            // Update description
            document.getElementById('role-description').textContent = roleDescriptions[currentRole];
            
            // Update role-specific KPIs
            const kpiContainer = document.getElementById('role-specific-kpis');
            const kpis = roleKPIs[currentRole];
            
            kpiContainer.innerHTML = kpis.map(kpi => `
                <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">${kpi.title}</p>
                            <p class="text-2xl font-semibold text-gray-900">${kpi.value}</p>
                            <p class="text-sm text-gray-500 mt-1">${kpi.subtitle}</p>
                        </div>
                        <div class="text-blue-600">
                            <i data-lucide="${kpi.icon}" class="w-6 h-6"></i>
                        </div>
                    </div>
                    ${kpi.change ? `
                        <div class="flex items-center space-x-1 mt-3">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                            <span class="text-sm font-medium text-green-600">${kpi.change}</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function toggleV1View() {
            const mainApp = document.getElementById('app');
            const v1View = document.getElementById('v1-view');
            const toggleBtn = document.getElementById('v1-toggle');
            
            if (isV1View) {
                mainApp.classList.add('hidden');
                v1View.classList.remove('hidden');
                toggleBtn.innerHTML = `
                    <i data-lucide="toggle-left" class="w-4 h-4 text-gray-400"></i>
                    <span class="text-sm text-gray-500">V1 View</span>
                `;
            } else {
                mainApp.classList.remove('hidden');
                v1View.classList.add('hidden');
                toggleBtn.innerHTML = `
                    <i data-lucide="toggle-right" class="w-4 h-4 text-blue-600"></i>
                    <span class="text-sm text-blue-600">V2 View</span>
                `;
            }
            
            // Re-initialize icons
            lucide.createIcons();
        }

        // Drilldown functionality
        function drillDown(type) {
            if (type === 'portfolio') {
                showCategories();
            } else if (type === 'forecast') {
                showForecastDetail();
            } else if (type === 'misses') {
                showMisses();
            }
        }

        function showCategories() {
            currentView = 'category';
            updateBreadcrumbs();
            showCategoryView();
            updateURL('category', selectedCategory, selectedSKU);
        }

        function showCategoryView() {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
                <div class="mb-8">
                    <h1 class="text-3xl font-semibold text-gray-900 mb-2">Categories</h1>
                    <p class="text-gray-500">Drill down into category performance</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="kpi-card card-hover p-6 shadow-sm cursor-pointer" onclick="chooseCategory('electronics')">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Electronics</h3>
                            <div class="status-dot status-high"></div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Revenue</span>
                                <span class="font-semibold text-gray-900">$850K</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Forecast</span>
                                <span class="font-semibold text-positive">+22%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Confidence</span>
                                <span class="font-semibold text-positive">High (87%)</span>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-warning rounded-lg">
                            <p class="text-sm text-warning">Supply down. Reorder now.</p>
                        </div>
                        <div class="mt-4 flex justify-end">
                            <button class="btn btn-secondary text-xs px-2 py-1" onclick="event.stopPropagation(); selectCategory('electronics')">View SKUs</button>
                        </div>
                    </div>

                    <div class="kpi-card card-hover p-6 shadow-sm cursor-pointer" onclick="chooseCategory('clothing')">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Clothing</h3>
                            <div class="status-dot status-medium"></div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Revenue</span>
                                <span class="font-semibold text-gray-900">$420K</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Forecast</span>
                                <span class="font-semibold text-negative">-8%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Confidence</span>
                                <span class="font-semibold text-negative">Low (35%)</span>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-negative rounded-lg">
                            <p class="text-sm text-negative">Sparse history. Investigate.</p>
                        </div>
                        <div class="mt-4 flex justify-end">
                            <button class="btn btn-secondary text-xs px-2 py-1" onclick="event.stopPropagation(); selectCategory('clothing')">View SKUs</button>
                        </div>
                    </div>

                    <div class="kpi-card card-hover p-6 shadow-sm cursor-pointer" onclick="chooseCategory('toys')">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Toys & Games</h3>
                            <div class="status-dot status-low"></div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Revenue</span>
                                <span class="font-semibold text-gray-900">$180K</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Forecast</span>
                                <span class="font-semibold text-negative">-15%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Confidence</span>
                                <span class="font-semibold text-positive">High (78%)</span>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-negative rounded-lg">
                            <p class="text-sm text-negative">Weeks of supply >8. Markdown recommended.</p>
                        </div>
                        <div class="mt-4 flex justify-end">
                            <button class="btn btn-secondary text-xs px-2 py-1" onclick="event.stopPropagation(); selectCategory('toys')">View SKUs</button>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-gray-900">Category Performance</h3>
                        <div class="inline-flex bg-gray-100 rounded-md p-1">
                            <button id="btn-scope-category" class="px-3 py-1 text-sm rounded-md bg-white shadow-sm">Category</button>
                            <button id="btn-scope-portfolio" class="px-3 py-1 text-sm rounded-md text-gray-600">Portfolio</button>
                        </div>
                    </div>
                    <div id="category-chart-subtitle" class="text-sm text-gray-500 mb-2"></div>
                    <div class="h-80 bg-white rounded-lg">
                        <div id="category-chart" class="w-full h-full"></div>
                    </div>
                </div>
            `;
            
            // Re-initialize icons
            lucide.createIcons();
            // Wire scope buttons
            const btnCat = document.getElementById('btn-scope-category');
            const btnPort = document.getElementById('btn-scope-portfolio');
            if (btnCat && btnPort) {
                btnCat.onclick = () => { if (categoryChartScope !== 'category') { categoryChartScope = 'category'; updateCategoryScopeButtons(); renderCategoryChart(); } };
                btnPort.onclick = () => { if (categoryChartScope !== 'portfolio') { categoryChartScope = 'portfolio'; updateCategoryScopeButtons(); renderCategoryChart(); } };
            }
            updateCategoryScopeButtons();
            setTimeout(renderCategoryChart, 50);
        }

        function selectCategory(categoryId) {
            selectedCategory = categoryId;
            currentView = 'sku';
            updateBreadcrumbs();
            showSKUView();
            updateURL('sku', selectedCategory, selectedSKU);
            setTimeout(renderCategoryChart, 50);
        }

        function showSKUView() {
            const mainContent = document.querySelector('main');
            const skuRows = buildSKURows(selectedCategory || 'electronics');
            mainContent.innerHTML = `
                <div class="mb-8">
                    <h1 class="text-3xl font-semibold text-gray-900 mb-2">SKUs - ${selectedCategory}</h1>
                    <p class="text-gray-500">Individual SKU performance and actions</p>
                </div>

                <div class="bg-white rounded-xl border border-gray-200 shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Revenue</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Units</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Miss Rate</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Confidence</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${skuRows}
                            </tbody>
                        </table>
                                            </div>
                                        </div>
            `;
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function selectSKU(skuId, encodedName) {
            selectedSKU = skuId;
            if (encodedName) {
                try { selectedSKUName = decodeURIComponent(encodedName); } catch(_) { selectedSKUName = encodedName; }
            } else {
                // Fallback: lookup by id
                selectedSKUName = findSKUName(selectedCategory || 'electronics', skuId);
            }
            currentView = 'sku-detail';
            updateBreadcrumbs();
            showSKUDetail();
            updateURL('sku-detail', selectedCategory, selectedSKU);
        }

        // ---------- SKU data helpers ----------
        function buildSKURows(categoryId) {
            const data = generateSKUs(categoryId);
            return data.map((row, idx) => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="selectSKU('${row.id}','${encodeURIComponent(row.name)}')">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                            <div class="w-2 h-2 ${row.dotClass} rounded-full mr-3"></div>
                                            <div>
                                <div class="text-sm font-medium text-gray-900">${row.name}</div>
                                <div class="text-sm text-gray-500">${row.categoryLabel}</div>
                                            </div>
                                        </div>
                                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${row.revenue}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${row.units}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">${row.missRate}%</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">${row.confidenceLabel} (${row.confidence}%)</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="${row.actionClass} text-xs px-3 py-1">${row.action}</button>
                                    </td>
                                </tr>
            `).join('');
        }

        function generateSKUs(categoryId) {
            const catalogs = {
                electronics: ['iPhone 15 Pro','Galaxy S24','MacBook Air','iPad Pro','Sony WH-1000XM5','Pixel 8','Apple Watch','Surface Laptop','GoPro Hero','Kindle Oasis','Dell XPS 13','Nintendo Switch'],
                clothing: ['Nike Air Max','Adidas Ultraboost','Levi\'s 501 Jeans','North Face Jacket','Uniqlo Hoodie','Patagonia Tee','Lululemon Shorts','Zara Dress','Columbia Fleece','H&M Chinos','Birkenstock Sandals','New Balance 990'],
                toys: ['LEGO Set','Hot Wheels Pack','Barbie Dreamhouse','Nerf Blaster','Puzzle 1000pc','Uno Cards','Monopoly Classic','Play-Doh Kit','RC Car','Jenga','Rubik\'s Cube','Action Figure']
            };
            const baseCat = categoryId === 'clothing' ? 'Clothing' : categoryId === 'toys' ? 'Toys & Games' : 'Electronics';
            const dots = ['bg-gray-400','bg-gray-500','bg-gray-600'];
            const actions = ['Reorder','Investigate','Markdown','Hold'];
            const names = catalogs[categoryId] || catalogs.electronics;
            return names.slice(0, 12).map((name, i) => {
                const id = `${categoryId}_${i}`;
                const units = 20 + (i * 7 % 180);
                const revenueVal = 2000 + (i * 137 % 7000);
                const revenue = `$${(revenueVal).toLocaleString()}`;
                const missRate = (2 + (i * 11 % 24) + (categoryId === 'clothing' ? 5 : 0)).toFixed(1);
                const conf = 45 + (i * 7 % 50);
                const confidence = Math.min(conf, 95);
                const confidenceLabel = confidence > 75 ? 'High' : confidence > 55 ? 'Medium' : 'Low';
                const action = actions[(i + (categoryId === 'toys' ? 1 : 0)) % actions.length];
                const actionClass = action === 'Reorder' || action === 'Markdown' ? 'btn btn-primary' : 'btn btn-secondary';
                return {
                    id,
                    name,
                    categoryLabel: baseCat,
                    units,
                    revenue,
                    missRate,
                    confidence,
                    confidenceLabel,
                    action,
                    actionClass,
                    dotClass: dots[i % dots.length]
                };
            });
        }

        function findSKUName(categoryId, skuId) {
            const list = generateSKUs(categoryId);
            const found = list.find(x => x.id === skuId);
            return found ? found.name : skuId;
        }

        function showSKUDetail() {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
                <div class="mb-8">
                    <h1 class="text-3xl font-semibold text-gray-900 mb-2">SKU Detail - ${selectedSKUName || selectedSKU}</h1>
                    <p class="text-gray-500">Individual SKU forecasting and backtesting</p>
                </div>

                <!-- Top row: Action (8) + Stock & Risk (4) -->
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-8">
                    <div class="lg:col-span-8">
                        <div class="bg-white rounded-xl border border-gray-200 shadow-lg overflow-hidden" id="sku-action-wrap">
                            <div id="sku-action-rail" class="h-full w-1.5 bg-blue-600 float-left"></div>
                            <div class="p-6 md:p-7" id="sku-action-card">
                                <!-- Populated by renderSKUAction() -->
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-lg overflow-hidden" id="sku-stock-card">
                            <!-- Populated by renderStockRiskCard() -->
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Historical Performance</h3>
                        <div class="h-64 bg-white rounded-lg">
                            <div id="sku-historical-chart" class="w-full h-full"></div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Forward Projection</h3>
                        <div class="h-64 bg-white rounded-lg">
                            <div id="sku-projection-chart" class="w-full h-full"></div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Confidence Analysis</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Overall Confidence</span>
                                <span class="font-semibold text-green-600">High (87%)</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Data Quality</span>
                                <span class="font-semibold text-green-600">Excellent</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Seasonality</span>
                                <span class="font-semibold text-green-600">Strong</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Backtest Results</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Model MAPE</span>
                                <span class="font-semibold text-green-600">8.2%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Baseline MAPE</span>
                                <span class="font-semibold text-red-600">15.7%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-500">Improvement</span>
                                <span class="font-semibold text-green-600">+47.8%</span>
                            </div>
                        </div>
                    </div>

                    <!-- placeholder removed; action card now above -->
                </div>
            `;
            
            // Re-initialize icons
            lucide.createIcons();
            setTimeout(() => { renderSKUHistoricalChart(); renderSKUProjectionChart(); renderSKUAction(); }, 50);
        }

        function updateBreadcrumbs() {
            const breadcrumbElement = document.getElementById('breadcrumbs');
            if (currentView === 'portfolio') {
                breadcrumbElement.innerHTML = `
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToPortfolio()">Portfolio</span>
                    <span>/</span>
                    <span class="text-gray-900">Overview</span>
                `;
            } else if (currentView === 'category') {
                breadcrumbElement.innerHTML = `
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToPortfolio()">Portfolio</span>
                    <span>/</span>
                    <span class="text-gray-900">Categories</span>
                `;
            } else if (currentView === 'sku') {
                breadcrumbElement.innerHTML = `
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToPortfolio()">Portfolio</span>
                    <span>/</span>
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToCategories()">Categories</span>
                    <span>/</span>
                    <span class="text-gray-900">SKUs</span>
                `;
            } else if (currentView === 'sku-detail') {
                breadcrumbElement.innerHTML = `
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToPortfolio()">Portfolio</span>
                    <span>/</span>
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToCategories()">Categories</span>
                    <span>/</span>
                    <span class="cursor-pointer hover:text-blue-600" onclick="goToSKUs()">SKUs</span>
                    <span>/</span>
                    <span class="text-gray-900">SKU Detail</span>
                `;
            }
        }

        // Navigation functions
        function goToHomepage() {
            currentView = 'portfolio';
            selectedCategory = null;
            selectedSKU = null;
            showPortfolioView();
            updateURL('portfolio', null, null, true);
            setTimeout(renderPortfolioChart, 50);
        }

        function goToPortfolio() {
            currentView = 'portfolio';
            selectedCategory = null;
            selectedSKU = null;
            showPortfolioView();
            updateURL('portfolio', null, null);
        }

        function goToCategories() {
            currentView = 'category';
            selectedSKU = null;
            updateBreadcrumbs();
            showCategoryView();
            updateURL('category', selectedCategory, null);
        }

        function goToSKUs() {
            currentView = 'sku';
            updateBreadcrumbs();
            showSKUView();
            updateURL('sku', selectedCategory, null);
        }

        function showPortfolioView() {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
                <!-- Hero Section -->
                <div class="mb-8">
                    <h1 class="text-3xl font-semibold text-gray-900 mb-2">Portfolio Overview</h1>
                    <p class="text-gray-500" id="role-description">
                        Revenue risk and inventory insights for operational decisions
                    </p>
                </div>

                <!-- Hero KPIs -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="kpi-card card-hover rounded-xl p-6 shadow-lg cursor-pointer" onclick="drillDown('portfolio')">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500 mb-1">Total Revenue</p>
                                <p class="text-2xl font-semibold text-gray-900">$2.4M</p>
                                <p class="text-sm text-gray-500 mt-1">Last 24 months</p>
                            </div>
                            <div class="text-blue-600">
                                <i data-lucide="dollar-sign" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1 mt-3">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                            <span class="text-sm font-medium text-green-600">+12.3%</span>
                        </div>
                    </div>

                    <div class="kpi-card card-hover rounded-xl p-6 shadow-lg cursor-pointer" onclick="drillDown('forecast')">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500 mb-1">Forecast Revenue</p>
                                <p class="text-2xl font-semibold text-gray-900">$2.7M</p>
                                <p class="text-sm text-gray-500 mt-1">Next 3 months</p>
                            </div>
                            <div class="text-blue-600">
                                <i data-lucide="trending-up" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1 mt-3">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                            <span class="text-sm font-medium text-green-600">+12.3%</span>
                        </div>
                    </div>

                    <div class="kpi-card card-hover rounded-xl p-6 shadow-lg cursor-pointer" onclick="drillDown('misses')">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500 mb-1">Miss Rate</p>
                                <p class="text-2xl font-semibold text-gray-900">8.2%</p>
                                <p class="text-sm text-gray-500 mt-1">Model vs Baseline</p>
                            </div>
                            <div class="text-blue-600">
                                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1 mt-3">
                            <i data-lucide="trending-down" class="w-4 h-4 text-red-600"></i>
                            <span class="text-sm font-medium text-red-600">-5.2%</span>
                        </div>
                    </div>
                </div>

                <!-- Role-specific KPIs -->
                <div id="role-specific-kpis" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Ops KPIs -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500 mb-1">Inventory Risk</p>
                                <p class="text-2xl font-semibold text-gray-900">Medium</p>
                                <p class="text-sm text-gray-500 mt-1">3 categories at risk</p>
                            </div>
                            <div class="text-blue-600">
                                <i data-lucide="package" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500 mb-1">Stockout Risk</p>
                                <p class="text-2xl font-semibold text-gray-900">Low</p>
                                <p class="text-sm text-gray-500 mt-1">2 SKUs flagged</p>
                            </div>
                            <div class="text-blue-600">
                                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Chart -->
                <div class="card p-6 mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Revenue Forecast vs Actuals</h3>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                                <span class="text-sm text-gray-500">Actual</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                                <span class="text-sm text-gray-500">Baseline</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <span class="text-sm text-gray-500">Model Forecast</span>
                            </div>
                        </div>
                    </div>
                    <div class="h-80 bg-white rounded-lg">
                        <div id="portfolio-chart" class="w-full h-full"></div>
                    </div>
                </div>

                <!-- Callouts Panel -->
                <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Insights</h3>
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-green-600 rounded-full mt-2"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">Electronics category up 22%</p>
                                <p class="text-xs text-gray-500">Supply down. Reorder now.</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">Clothing confidence low</p>
                                <p class="text-xs text-gray-500">Sparse history. Investigate.</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="w-2 h-2 bg-red-600 rounded-full mt-2"></div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">Toys & Games forecast down 15%</p>
                                <p class="text-xs text-gray-500">Weeks of supply >8. Markdown recommended.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CTA Tiles -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    <button class="card p-6 hover:shadow-md transition-shadow text-left" onclick="showCategories()">
                        <div class="flex items-center space-x-3 mb-2">
                            <i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-600"></i>
                            <h4 class="font-semibold text-gray-900">View Categories</h4>
                        </div>
                        <p class="text-sm text-gray-500">Drill down into category performance</p>
                    </button>
                    
                    <button class="card p-6 hover:shadow-md transition-shadow text-left">
                        <div class="flex items-center space-x-3 mb-2">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-500"></i>
                            <h4 class="font-semibold text-gray-900">View Misses</h4>
                        </div>
                        <p class="text-sm text-gray-500">Analyze forecast errors</p>
                    </button>
                    
                    <button class="card p-6 hover:shadow-md transition-shadow text-left">
                        <div class="flex items-center space-x-3 mb-2">
                            <i data-lucide="package" class="w-5 h-5 text-green-600"></i>
                            <h4 class="font-semibold text-gray-900">View Actions</h4>
                        </div>
                        <p class="text-sm text-gray-500">Take recommended actions</p>
                    </button>
                </div>
            `;
            
            updateBreadcrumbs();
            updateRoleContent();
            lucide.createIcons();
            // Ensure portfolio chart renders after DOM injection when navigating home
            setTimeout(renderPortfolioChart, 50);
        }
    </script>
</body>
</html>


